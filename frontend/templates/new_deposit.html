{% extends "base.html" %}
{% block title %}New Deposit{% endblock %}

{% block content %}
<div class="row justify-content-center mt-5">
  <div class="col-md-6">
    <h3 class="text-center mb-4">Create New Deposit</h3>
    <form id="depositForm">
      <div class="mb-3">
        <label for="amount" class="form-label">Amount</label>
        <input type="number" step="0.01" class="form-control" id="amount" required />
      </div>
      <div class="mb-3">
        <label for="currency" class="form-label">Currency</label>
        <select class="form-control" id="currency">
          <option value="USDT">USDT</option>
          <option value="TRX">TRX</option>
          <option value="BTC">BTC</option>
        </select>
      </div>
      <div class="mb-3">
        <label for="trx_id" class="form-label">Transaction ID</label>
        <input type="text" class="form-control" id="trx_id" required />
      </div>
      <button type="submit" class="btn btn-primary w-100">Submit Deposit</button>
    </form>
    <div id="message" class="mt-3 text-center"></div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.getElementById("depositForm").addEventListener("submit", async function (e) {
  e.preventDefault();

  const token = localStorage.getItem("token");
  if (!token) {
    alert("You must be logged in to submit a deposit.");
    return;
  }

  const amount = document.getElementById("amount").value;
  const currency = document.getElementById("currency").value;
  const trx_id = document.getElementById("trx_id").value;

  const res = await fetch("/api/deposits/", {
    method: "POST",
    headers: {
      "Authorization": "Token " + token,
      "Content-Type": "application/json",
    },
    body: JSON.stringify({
      amount: amount,
      currency: currency,
      trx_id: trx_id,
    }),
  });

  const msgBox = document.getElementById("message");
  if (res.ok) {
    msgBox.innerHTML = `<div class="alert alert-success">Deposit submitted successfully!</div>`;
    document.getElementById("depositForm").reset();
  } else {
    const data = await res.json();
    msgBox.innerHTML = `<div class="alert alert-danger">Error: ${JSON.stringify(data)}</div>`;
  }
});
</script>
{% endblock %}
